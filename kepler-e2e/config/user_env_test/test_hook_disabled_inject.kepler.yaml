# Service runs as testuser1. Hook has user_identity: false.
# With injection disabled, the hook should NOT get testuser1's env vars
# injected â€” USER should come from the inherited service env (which has
# testuser1's injected values from the service level).
# This test verifies user_identity: false on a hook prevents hook-level injection.
# We verify by checking that the hook sees the service's environment as-is.
kepler:
  logs:
    buffer_size: 0

services:
  user-env-svc:
    command: ["sh", "-c", "sleep 300"]
    user: testuser1
    inherit_env: true
    restart: no
    hooks:
      pre_start:
        run: "echo USER=$USER; echo HOME=$HOME"
        user_identity: false
