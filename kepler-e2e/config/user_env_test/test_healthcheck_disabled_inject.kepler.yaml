# Service runs as testuser1 with explicit USER=custom_user in environment.
# Healthcheck has inject_user_env: none — injection is disabled.
# The healthcheck should see USER=custom_user from the service's computed_env.
# The healthcheck asserts USER == custom_user → passes only if injection is skipped.
kepler:
  logs:
    buffer_size: 0

services:
  user-env-svc:
    command: ["sh", "-c", "sleep 300"]
    user: testuser1
    inherit_env: true
    environment:
      - USER=custom_user
    restart: no
    healthcheck:
      run: "test \"$USER\" = custom_user"
      interval: 2s
      timeout: 5s
      retries: 1
      start_period: 0s
      inject_user_env: none
