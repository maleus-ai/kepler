# Test effective_wait: wait: true override on a deferred-condition service
# monitor has service_failed condition (normally deferred) but wait: true
# forces it into the startup cluster.
#
# With --wait mode, CLI should block for ALL services including monitor.
# Since monitor depends on database failing (which won't happen during
# normal startup), this will timeout - but the point is to verify
# monitor IS in the startup cluster via ps status.
#
# We use a timeout on the dependency to prevent infinite blocking.
# monitor will fail to start (timeout), but app should start fine.

kepler:
  logs:
    buffer_size: 0

services:
  database:
    command: ["sh", "-c", "echo DATABASE_STARTED; sleep 300"]

  app:
    command: ["sh", "-c", "echo APP_STARTED; sleep 300"]
    depends_on:
      - database

  monitor:
    command: ["sh", "-c", "echo MONITOR_STARTED; sleep 300"]
    wait: true
    depends_on:
      database:
        condition: service_failed
        timeout: 3s
