# Test effective_wait: mix of startup and deferred services
# database + app = startup cluster (service_started, service_healthy)
# monitor = deferred (service_failed condition)
#
# With --wait mode, CLI should return after database + app are running,
# while monitor continues waiting in background.

kepler:
  logs:
    buffer_size: 0

services:
  database:
    command: ["sh", "-c", "echo DATABASE_STARTED; sleep 300"]
    healthcheck:
      test: ["true"]
      interval: 500ms
      timeout: 1s
      retries: 1
      start_period: 0s

  app:
    command: ["sh", "-c", "echo APP_STARTED; sleep 300"]
    depends_on:
      database:
        condition: service_healthy

  monitor:
    command: ["sh", "-c", "echo MONITOR_STARTED; sleep 300"]
    depends_on:
      database:
        condition: service_failed
