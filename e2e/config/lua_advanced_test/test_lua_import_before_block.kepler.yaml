# Test that lua_import is executed AFTER lua: block regardless of YAML order
# Note: In YAML, the lua: block is defined first, so it runs first
# lua_import runs second regardless of YAML order
lua_import:
  - __LUA_FILE__

lua: |
  global.load_order = {}
  table.insert(global.load_order, "lua_block")

services:
  import-first-service:
    environment: !lua |
      return {"LOAD_ORDER=" .. table.concat(global.load_order, ",")}
    command: ["sh", "-c", "echo LOAD_ORDER=$LOAD_ORDER && sleep 30"]
    restart: no
